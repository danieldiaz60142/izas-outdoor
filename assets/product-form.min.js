if(!customElements.get("product-form")){class t extends HTMLElement{constructor(){super(),this.hasChildNodes()&&this.init()}init(){this.form=this.querySelector(".js-product-form"),this.form&&(this.form.querySelector('[name="id"]').disabled=!1,this.cartDrawer=document.querySelector("cart-drawer"),this.submitBtn=this.querySelector('[name="add"]'),"no-js"!==theme.settings.afterAtc&&this.addEventListener("submit",this.handleSubmit.bind(this)))}async handleSubmit(e){if("product-signup_form"===e.target.id||(e.preventDefault(),"true"===this.submitBtn.getAttribute("aria-disabled")))return;theme.settings.vibrateOnATC&&window.navigator.vibrate&&window.navigator.vibrate(100),this.errorMsg=null,this.setErrorMsgState(),this.submitBtn.setAttribute("aria-disabled","true"),this.submitBtn.classList.add("is-loading"),document.getElementById("btn-sticky-add-cart")&&(document.getElementById("btn-sticky-add-cart").classList.add("is-loading"),document.getElementById("btn-sticky-add-cart").disabled=!0);let s=new FormData(this.form),i="cart-icon-bubble";this.cartDrawer&&(i+=`,${this.cartDrawer.closest(".shopify-section").id.replace("shopify-section-","")}`),s.append("sections_url",window.location.pathname),s.append("sections",i);try{let a=await fetch(`${theme.routes.cart}.js`);if(!a.ok)throw Error(a.status);let r=await a.json(),n=await fetch(theme.routes.cartAdd,{method:"POST",headers:{Accept:"application/javascript","X-Requested-With":"XMLHttpRequest"},body:s}),d=await n.json(),c="string"==typeof d.description?d.description:d.message;if(d.status&&this.setErrorMsgState(c),!n.ok)throw Error(n.status);if("page"===theme.settings.afterAtc)setTimeout(()=>{window.location.href=theme.routes.cart},300);else{t.updateCartIcon(d);let o=this.closest("quick-add-drawer");o&&o.addedToCart(),setTimeout(()=>{if(this.cartDrawer)this.cartDrawer.renderContents(d,!o&&"drawer"===theme.settings.afterAtc);else if(window.location.pathname===theme.routes.cart){let t=document.querySelector("cart-items");t&&("true"===t.dataset.empty?window.location.reload():t.refreshCart())}},700)}let l=await fetch(`${theme.routes.cart}.js`);if(!l.ok)throw Error(l.status);let u=await l.json(),h=r.items.filter(t=>t.variant_id===d.variant_id)[0];h?this.dispatchEvent(new CustomEvent("on:line-item:change",{bubbles:!0,detail:{cart:u,variantId:d.variant_id,oldQuantity:h.quantity,newQuantity:h.quantity===d.quantity?h.quantity:d.quantity}})):this.dispatchEvent(new CustomEvent("on:cart:add",{bubbles:!0,detail:{cart:u,variantId:d.variant_id}}))}catch(b){console.log(b),this.dispatchEvent(new CustomEvent("on:cart:error",{bubbles:!0,detail:{error:this.errorMsg.textContent}}))}finally{this.submitBtn.classList.add("is-success"),document.getElementById("btn-sticky-add-cart")&&document.getElementById("btn-sticky-add-cart").classList.add("is-success"),this.submitBtn.removeAttribute("aria-disabled"),setTimeout(()=>{this.submitBtn.classList.remove("is-loading"),this.submitBtn.classList.remove("is-success"),document.getElementById("btn-sticky-add-cart")&&(document.getElementById("btn-sticky-add-cart").classList.remove("is-loading"),document.getElementById("btn-sticky-add-cart").classList.remove("is-success"),document.getElementById("btn-sticky-add-cart").disabled=!1)},1400)}}static updateCartIcon(t){let e=document.getElementById("cart-icon-bubble");e&&(e.innerHTML=t.sections["cart-icon-bubble"])}setErrorMsgState(t=!1){this.errorMsg=this.errorMsg||this.querySelector(".js-form-error"),this.errorMsg&&(this.errorMsg.hidden=!t,t&&(this.errorMsg.textContent=t))}}customElements.define("product-form",t)}